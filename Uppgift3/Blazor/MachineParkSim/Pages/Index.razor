@page "/"
<h3>Devices</h3>

@if (devices == null)
{
    <p><em>Loading...</em></p>
}
else
{
    @*<ul>
        @foreach (var device in devices)
        {
            <li>
                <p>@device.deviceId</p>
                <p>@device.connectionState</p>
                <p>@device.status</p>
            </li>
        }
    </ul>*@

    @foreach (var device in devices)
    {

        <div class="card mb-3">
            <div class="card-header d-flex @*@BgColour(device)*@">
                @device.DeviceId
            </div>
            <div class="card-body d-flex">
                <div class="col">
                    <div class="font-weight-bold">Device Id</div>
                    <div>@device.DeviceName</div>
                </div>
                <div class="col">
                    <div class="row">
                        <div class="font-weight-bold">Status: </div>
                        <div>@device.ConnectionState</div>
                    </div>
                    <div class="row">
                        <div class="font-weight-bold">Data: </div>
                        <div>@device.JsonData</div>
                    </div>
                </div>
                <div class="col">
                    <button @onclick="@(e => ConClick(e, device))">@ButtonText(device)</button>
                    <button>Start</button>
                </div>
            </div>
        </div>
    }
}


@*@code {
    private DeviceTwinModel[] devices;

    protected override async Task OnInitializedAsync()
    {
        devices = await Http.GetFromJsonAsync<DeviceTwinModel[]>("https://net21upg3-funcapp.azurewebsites.net/api/GetDevicesInformation?");
    }
}*@

@code {
    private dynamic[] devices;

    protected override async Task OnInitializedAsync()
    {
        devices = await Http.GetFromJsonAsync<IotDeviceModel[]>("https://net21upg3-funcapp.azurewebsites.net/api/GetTwinDevices?");
        //devices = await Http.GetFromJsonAsync<DeviceModel[]>("https://net21upg3-funcapp.azurewebsites.net/api/GetItems?code=QRwDjHr6SMzuAXHYqML1QwQZ6Q9f90DyJe74TogwnxrV09eWWvSaXQ==");


   
    }

    public class Machine
    {
        public Guid id { get; set; }
        public string description { get; set; }
        public bool connected { get; set; }
        public string[] data { get; set; }
    }

    private string BgColour(IotDeviceModel device)
    {
        //if (device.connectionState == "Connected")
        //    return "bg-success";
        //else
        return "bg-danger";
    }


    private string ButtonText(IotDeviceModel device)
    {
        //if (device.connectionState == "Connected")
        //    return "Stop";
        //else
        return "Start";

    }

    private string CheckConnection(bool db)
    {
        //if (db == true)
        //    return "online";
        //else
        return "offline";
    }

    private void ConClick(MouseEventArgs e, IotDeviceModel device)
    {

        //device.connected = !machine.connected;
    }

}
